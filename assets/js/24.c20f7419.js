(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{467:function(t,a,e){"use strict";e.r(a);var r=e(9),n=Object(r.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[e("strong",[t._v("本文为作者个人整理，仅作参考,by Mr Zhou.")])]),t._v(" "),e("h1",{attrs:{id:"rabbitmq"}},[t._v("rabbitmq")]),t._v(" "),e("h2",{attrs:{id:"_1-rabbitmq-部署手册"}},[t._v("1.rabbitmq 部署手册")]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/rabbitmq01.png",alt:""}})]),t._v(" "),e("h3",{attrs:{id:"_1-1环境准备"}},[t._v("1.1环境准备")]),t._v(" "),e("ul",[e("li",[t._v("下载erlang需要20版本以后的：\n"),e("code",[t._v("https://packages.erlang-solutions.com/erlang/rpm/centos/7/x86_64/esl-erlang_22.0.7-1~centos~7_amd64.rpm")])]),t._v(" "),e("li",[t._v("下载rabbitmq-server:\n"),e("code",[t._v("wget https://www.rabbitmq.com/releases/rabbitmq-server/v3.6.0/rabbitmq-server-3.6.0-1.noarch.rpm")]),t._v("\n或者使用rabbitmq的yum源")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[bintray-rabbitmq-server]\nname=bintray-rabbitmq-rpm\nbaseurl=https://dl.bintray.com/rabbitmq/rpm/rabbitmq-server/v3.7.x/el/7/\ngpgcheck=0\nrepo_gpgcheck=0\nenabled=1\n")])])]),e("h3",{attrs:{id:"_1-2安装"}},[t._v("1.2安装")]),t._v(" "),e("ul",[e("li",[t._v("配置开机启动服务；\n"),e("code",[t._v("systemctl enable rabbitmq-server.service")])]),t._v(" "),e("li",[t._v("启动服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('systemctl start rabbitmq-server.service\nrabbitmq-server -detached\nnohup rabbitmq-server start &\n启动报错：ERROR: epmd error for host 80: badarg (unknown POSIX error)\n解决方案：echo "NODENAME=rabbit@localhost" >>/etc/rabbitmq/rabbitmq-env.conf \n激活rabbitmq management界面\n\n参考 http://www.rabbitmq.com/management.html#configuration\n\n需要rabbitmq启动才能激活插件\n\nrabbitmq-plugins enable rabbitmq_management\n')])])]),e("ul",[e("li",[t._v("添加管理员")])]),t._v(" "),e("p",[t._v("参考 "),e("code",[t._v("https://segmentfault.com/a/1190000003720119")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('rabbitmqctl add_user admin 123456\n\nrabbitmqctl set_user_tags admin administrator\n\nrabbitmqctl set_permissions -p / admin "." "." ".*"\n修改用户密码：\nrabbitmqctl change_password Username \'Newpassword\'\n\n访问admin\n\n浏览器 http://IP:15672/\n\nadmin/123456\n')])])]),e("h2",{attrs:{id:"_2-集群搭建手册"}},[t._v("2 集群搭建手册")]),t._v(" "),e("h3",{attrs:{id:"_2-1-先搭cluster再搭ha"}},[t._v("2.1 先搭cluster再搭HA；")]),t._v(" "),e("p",[t._v("根据搭建手册在另一台上也安装好rabbitmq-server，注意要启用web插件，否则会报错："),e("code",[t._v("Node statistics not available;")])]),t._v(" "),e("ul",[e("li",[t._v("配置相同的erlang.cookie；")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("scp /var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmq\nchown rabbitmq:rabbitmq /var/lib/rabbitmq/.erlang.cookie\n")])])]),e("ul",[e("li",[t._v("创建两个独立的broker")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("node1> rabbitmq-server -detached\n\nnode2> rabbitmq-server -detached\n\n验证一下名字 rabbitmqctl cluster_status\n")])])]),e("ul",[e("li",[t._v("在node1节点关闭当前rabbitmq服务")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('node1> rabbitmqctl stop_app\n把node2中的集群加入到node1中\nnode1> rabbitmqctl join_cluster --ram rabbit@node2\n在node1上开启rabbitmq服务，查看集群状态\n[root@node1 ~]# rabbitmqctl start_app\nStarting node rabbit@node1 ...\ncompleted with 3 plugins.\n[root@node1 ~]# rabbitmqctl cluster_status\nCluster status of node rabbit@node1 ...\n[{nodes,[{disc,[rabbit@node2]},{ram,[rabbit@node1]}]},\n{running_nodes,[rabbit@node2,rabbit@node1]},\n{cluster_name,<<"rabbit@node2">>},\n{partitions,[]},\n{alarms,[{rabbit@node2,[]},{rabbit@node1,[]}]}]\n')])])]),e("h3",{attrs:{id:"_2-2-设置镜像队列数据的命令"}},[t._v("2.2 设置镜像队列数据的命令：")]),t._v(" "),e("p",[e("code",[t._v('rabbitmqctl set_policy -p / ha-allqueue "^queue" \'{"ha-mode":"all"}\'')]),t._v("\n以后创建ha队列的时候需要指定参数；\n"),e("img",{attrs:{src:"/img/rabbitmq02.png",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"_3-删除节点"}},[t._v("3 删除节点")]),t._v(" "),e("ul",[e("li",[t._v("在被删除的节点上停止运行；\n"),e("code",[t._v("node5 # rabbitmqctl stop")])]),t._v(" "),e("li",[t._v("在主节点上删除操作；\n"),e("code",[t._v("node2 # rabbitmqctl -n rabbit@cddtestserver02 forget_cluster_node rabbit@productserver5")]),t._v(" "),e("img",{attrs:{src:"/img/rabbitmq03.png",alt:""}})])])])}),[],!1,null,null,null);a.default=n.exports}}]);